@using ParkingManagement.Services
@inject ILocalStorageService LocalStorage
@inject NavigationManager Navigation

@code {
    private bool isAuthenticated = false;
    private string username = "";

    protected override async Task OnInitializedAsync()
    {
        var loginStatus = await LocalStorage.GetItemAsync<string>("isLoggedIn");
        var storedUsername = await LocalStorage.GetItemAsync<string>("username");
        
        isAuthenticated = loginStatus == "true";
        username = storedUsername ?? "";
        
        if (!isAuthenticated && Navigation.Uri != "/login")
        {
            Navigation.NavigateTo("/login");
        }
    }

    public async Task Logout()
    {
        await LocalStorage.RemoveItemAsync("isLoggedIn");
        await LocalStorage.RemoveItemAsync("username");
        isAuthenticated = false;
        username = "";
        Navigation.NavigateTo("/login");
    }

    public bool IsAuthenticated => isAuthenticated;
    public string Username => username;
}
